<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÇŸêŸäŸéŸÖŸä - ÿ™ŸÖÿ±ŸäŸÜ ŸÖŸÑÿ° ÿßŸÑŸÅÿ±ÿßÿ∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Temel Sayfa Stilleri --- */
        :root {
            --accent-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-light: #f8f9fa;
            --font-arabic: 'Noto Naskh Arabic', 'Tahoma', 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            font-weight: 400;
        }

        /* --- Ana Etkinlik Alanƒ± (16:9 ve 9:16) --- */
        .activity-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            width: 90vw;
            height: calc(90vw * 9 / 16); /* 16:9 */
            max-height: 90vh;
            max-width: calc(90vh * 16 / 9); /* 16:9 */
        }
        
        /* --- Geri Tu≈üu (Header ƒ∞√ßin) --- */
        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end; 
        }
        .back-button {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-button:hover {
            background: #e0e0e0;
        }
        .back-button svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }


        /* --- Ba≈ülƒ±k ve ƒ∞lerleme √áubuƒüu (Simetrik 3 S√ºtun) --- */
        .header {
            padding: 15px 25px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            grid-template-areas: "progress instruction back"; 
            grid-template-columns: 200px 1fr 200px;
            align-items: center;
            gap: 20px;
        }
        
        #instruction-text { /* Y√∂nerge (Ortada) */
            grid-area: instruction;
            text-align: center; 
            font-size: 2.2rem; 
            font-weight: 700;
            color: #555;
        }
        
        .progress-container { /* ƒ∞lerleme √áubuƒüu (Saƒüda) */
            grid-area: progress;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: flex-start;
            width: 200px;
            direction: ltr; 
        }
        #progress-display {
            font-size: 1.5rem; 
            font-weight: bold;
            color: var(--accent-color);
            flex-shrink: 0;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.4s ease, background-color 0.4s ease;
        }


        /* --- Asƒ±l Etkinlik Alanƒ± --- */
        .activity-area {
            flex-grow: 1;
            padding: 10px 20px; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            overflow-y: auto;
            padding-top: 15px; 
        }

        /* --- ƒ∞pucu Stilleri --- */
        .hint-bar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; 
            gap: 10px;
            margin-bottom: 20px;
            direction: rtl; 
        }
        .hint-tag {
            font-size: 1.5rem;
            font-weight: 700;
            color: #aaa;
            background-color: #f0f0f0;
            padding: 5px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
            border: 2px solid #f0f0f0;
        }
        .hint-tag.active {
            color: var(--accent-color);
            border-color: var(--accent-color);
            background-color: #e6f2ff;
            transform: scale(1.05);
        }


        /* --- Soru Tipi: Bo≈üluk Doldurma --- */
        .fill-in-blank-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            justify-content: center; 
        }
        .question-text {
            font-size: 3.5rem;
            font-weight: 700;
            color: #212529;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            line-height: 1.6;
        }
        .answer-input {
            font-size: 3rem;
            font-weight: 700;
            font-family: var(--font-arabic);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 5px 15px;
            width: 300px;
            max-width: 80%;
            text-align: center;
            margin: 0 15px;
            min-height: 60px; 
            background: #f8f9fa;
            direction: rtl; 
            color: #333;
        }
        
        /* --- Sanal Klavye --- */
        .keyboard-container {
            width: 100%;
            margin-top: 10px;
            direction: rtl; 
            user-select: none;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .key-row {
            display: flex;
            justify-content: center;
            gap: 0.5vw; 
            margin-bottom: 0.5vw;
        }
        .key {
            font-family: var(--font-arabic);
            font-size: 2rem;
            font-weight: 700;
            height: 60px;
            flex-grow: 1; 
            flex-basis: 0; 
            max-width: 70px; 
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
            border: 1px solid #ccc;
        }
        .key:active {
            transform: scale(0.95);
        }
        .key.backspace {
            max-width: 100px; 
            font-size: 1.5rem;
            color: white;
        }

        /* --- Kontrol Butonlarƒ± --- */
        #check-scramble-btn, #reset-scramble-btn {
            padding: 15px 30px;
            font-size: 2rem; 
            font-family: var(--font-arabic);
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin: 5px;
        }
        #check-scramble-btn {
            background-color: var(--success-color);
            color: white;
        }
        #reset-scramble-btn {
            background-color: var(--danger-color);
            color: white;
        }
        .scramble-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }


        /* --- Geri Bildirim Ekranƒ± (‚úî / ‚ùå) --- */
        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 15rem;
            z-index: 200;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .feedback-overlay.show {
            visibility: visible;
            opacity: 1;
        }
        .feedback-overlay .correct { color: var(--success-color); }
        .feedback-overlay .incorrect { color: var(--danger-color); }
        
        #feedback-details {
            display: none; 
            flex-direction: column;
            align-items: center;
            position: absolute;
            bottom: 5%; 
            width: 100%;
        }
        #feedback-correct-answer {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            background: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        #feedback-ok-button {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            background-color: var(--success-color);
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* --- Biti≈ü Ekranƒ± --- */
        #finish-screen {
            text-align: center;
            font-weight: 700;
            color: var(--accent-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        #finish-screen p {
            font-size: 3.5rem; 
            margin: 10px 0;
        }
        .score-display {
            display: flex;
            gap: 30px;
            font-size: 2.8rem; 
            margin: 20px 0;
            direction: ltr;
        }
        .score-item {
            font-weight: 700;
        }
        .score-correct {
            color: var(--success-color);
        }
        .score-incorrect {
            color: var(--danger-color);
        }
        #replay-button {
            font-size: 4.5rem; 
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        #replay-button:hover {
            transform: rotate(-90deg);
            background-color: #f0f0f0;
        }
        
        /* --- Mobil D√ºzen --- */
        @media (orientation: portrait) {
            .activity-container {
                width: 95vw;
                height: calc(95vw * 16 / 9); /* 9:16 */
                max-height: 95vh;
                max-width: calc(95vh * 9 / 16); /* 9:16 */
            }

            .header {
                grid-template-areas: 
                    "progress back"
                    "instruction instruction";
                grid-template-columns: 1fr 1fr; 
                gap: 10px;
                padding: 10px 15px;
            }

            .progress-container {
                width: auto; 
                justify-content: flex-start;
            }
            .back-button-container {
                justify-content: flex-end;
            }
            #instruction-text {
                font-size: 1.4rem; 
                min-width: unset;
                justify-self: center;
            }
            #progress-display {
                font-size: 1.2rem; 
            }
            
            /* Mobil: ƒ∞pucu */
            .hint-bar { gap: 5px; margin-bottom: 10px; }
            .hint-tag { font-size: 1.1rem; padding: 3px 10px; }


            /* Mobil: Bo≈üluk Doldurma ve Klavye */
            .question-text { 
                font-size: 1.8rem; 
                line-height: 1.5;
                margin-bottom: 5px;
            }
            .answer-input { 
                font-size: 1.6rem; 
                min-height: 45px; 
                width: 200px;
            }
            .keyboard-container { margin-top: 5px; }
            .key { 
                height: 45px; 
                font-size: 1.2rem; 
                border-radius: 5px;
            }
            .key.backspace { font-size: 1rem; }
            .scramble-controls { margin-top: 5px; }
            #check-scramble-btn, #reset-scramble-btn {
                font-size: 1.5rem; 
                padding: 10px 20px;
            }
            
            /* Mobil: Geri bildirim */
            #feedback-correct-answer {
                font-size: 1.5rem;
            }
            #feedback-ok-button {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
                margin-top: 10px;
            }
        }

    </style>
</head>
<body>

    <div class="activity-container">
        
        <div class="header">
            <div class="progress-container">
                <div id="progress-display">...</div> 
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
            
            <div id="instruction-text">...</div>

            <div class="back-button-container">
                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="activity-area" id="activity-area">
            </div>

        <div class="feedback-overlay" id="feedback-overlay">
            <span id="feedback-icon"></span>
            
            <div id="feedback-details">
                <div id="feedback-correct-answer"></div>
                <button id="feedback-ok-button">‚úî</button>
            </div>
        </div>

    </div>

    <script>
        // --- KLAVYE TASARIMI (Kullanƒ±cƒ±dan Gelen) ---
        const colorMap={'ÿ®':'#a0c4ff','ÿ™':'#a0c4ff','ÿ´':'#a0c4ff','ŸÜ':'#a0c4ff','Ÿä':'#a0c4ff','ÿ¨':'#caffbf','ÿ≠':'#caffbf','ÿÆ':'#caffbf','ÿØ':'#fdffb6','ÿ∞':'#fdffb6','ÿ±':'#ffd6a5','ÿ≤':'#ffd6a5','ÿ≥':'#ffadad','ÿ¥':'#ffadad','ÿµ':'#bdb2ff','ÿ∂':'#bdb2ff','ÿ∑':'#9bf6ff','ÿ∏':'#9bf6ff','ÿπ':'#ffc6ff','ÿ∫':'#ffc6ff','ŸÅ':'#b9f6ca','ŸÇ':'#b9f6ca','Ÿá':'#b3e5fc','ÿ©':'#b3e5fc','ÿ°':'#ffccbc','ÿ§':'#ffccbc','ÿ¶':'#ffccbc','ÿß':'#e0e0e0','ŸÑ':'#e0e0e0','ŸÉ':'#d1c4e9','ŸÖ':'#f8bbd0','Ÿà':'#c5cae9'};
        const defaultColor='#FFFFFF';
        const backspaceBg = '#E53935';
        
        function getDarkerColor(hex) {
            if (!hex || hex === '#FFFFFF') hex = '#CCCCCC'; 
            if (hex.length === 4) { 
                hex = `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`;
            }
            
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            
            r = Math.floor(r * 0.85); 
            g = Math.floor(g * 0.85);
            b = Math.floor(b * 0.85);
            
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }
        
        const backspaceShadow = getDarkerColor(backspaceBg);
        
        const keyRows = [
            ["ÿØ","ÿ¨","ÿ≠","ÿÆ","Ÿá","ÿπ","ÿ∫","ŸÅ","ŸÇ","ÿ´","ÿµ","ÿ∂"],
            ["ÿ∑","ŸÉ","ŸÖ","ŸÜ","ÿ™","ÿß","ŸÑ","ÿ®","Ÿä","ÿ≥","ÿ¥","ÿ∞"],
            ["Backspace", "ÿ∏","ÿ≤","Ÿà","ÿ©","Ÿâ","ÿ±","ÿ§","ÿ°","ÿ¶"] 
        ];

        // --- YENƒ∞: ETKƒ∞NLƒ∞K VERƒ∞LERƒ∞ (30 Soru - E≈ü Anlamlƒ± ve Belirsizlikler D√ºzeltildi) ---
        const activitiesData = [
            // Zamirler (9)
            { pre: "", post: "ŸäŸéÿ∞ŸíŸáŸéÿ®ŸèŸàŸÜŸé ÿ•ŸêŸÑŸéŸâ ÿßŸÑŸÖŸéÿ≥Ÿíÿ¨ŸêÿØ", a: "ŸáŸèŸÖŸí", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },
            { pre: "", post: "ŸäŸèŸÉŸíÿ±ŸêŸÖŸíŸÜŸé ÿßŸÑÿ∂ŸëŸèŸäŸèŸàŸÅ", a: "ŸáŸèŸÜŸëŸé", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },
            { pre: "", post: "ŸäŸéÿπŸíŸÖŸéŸÑŸéÿßŸÜŸê ŸÅŸêŸä ÿßŸÑŸÖŸéÿµŸíŸÜŸéÿπ", a: "ŸáŸèŸÖŸéÿß", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },
            { pre: "", post: "ŸÜŸéÿ≠Ÿíÿ™Ÿéÿ±ŸêŸÖŸè ÿßŸÑŸÉŸêÿ®Ÿéÿßÿ±", a: "ŸÜŸéÿ≠ŸíŸÜŸè", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },
            { pre: "", post: "ŸäŸéÿπŸíŸÖŸéŸÑŸè ŸÅŸêŸä ÿßŸÑŸÖŸéÿµŸíŸÜŸéÿπ", a: "ŸáŸèŸàŸé", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },
            { pre: "", post: "ÿ™ŸéÿπŸíŸÖŸéŸÑŸè ŸÅŸêŸä ÿßŸÑŸÖŸèÿ≥Ÿíÿ™Ÿéÿ¥ŸíŸÅŸéŸâ", a: ["ŸáŸêŸäŸé", "ÿ£ŸéŸÜŸíÿ™Ÿé"], hint: "ÿ∂ŸéŸÖŸêŸäÿ±" }, 
            { pre: "", post: "ÿ™Ÿéÿ≠Ÿíÿ™Ÿéÿ±ŸêŸÖŸè ÿßŸÑŸÉŸêÿ®Ÿéÿßÿ±", a: ["ÿ£ŸéŸÜŸíÿ™Ÿé", "ŸáŸêŸäŸé"], hint: "ÿ∂ŸéŸÖŸêŸäÿ±" }, 
            { pre: "", post: "ÿ£Ÿèÿ≠Ÿêÿ®ŸëŸè ÿ£ŸéŸÇÿßÿ±Ÿêÿ®Ÿä", a: "ÿ£ŸéŸÜŸéÿß", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },
            { pre: "", post: "ÿ™Ÿéÿ≠Ÿíÿ™Ÿéÿ±ŸêŸÖŸèŸàŸÜŸé ÿßŸÑŸÉŸêÿ®Ÿéÿßÿ±", a: "ÿ£ŸéŸÜŸíÿ™ŸèŸÖŸí", hint: "ÿ∂ŸéŸÖŸêŸäÿ±" },

            // Fiil √áekimleri (10)
            { pre: "ŸáŸèŸÖŸí", post: "ÿ•ŸêŸÑŸéŸâ ÿßŸÑŸÖŸéÿ≥Ÿíÿ¨ŸêÿØ", a: "ŸäŸéÿ∞ŸíŸáŸéÿ®ŸèŸàŸÜŸé", hint: "ŸÅŸêÿπŸíŸÑ" },
            { pre: "ŸáŸèŸÜŸëŸé", post: "ÿßŸÑÿ∂ŸëŸèŸäŸèŸàŸÅ", a: "ŸäŸèŸÉŸíÿ±ŸêŸÖŸíŸÜŸé", hint: "ŸÅŸêÿπŸíŸÑ" },
            { pre: "ŸáŸèŸàŸé", post: "ÿ£ŸéŸÇÿßÿ±Ÿêÿ®ŸéŸáŸè", a: ["ŸäŸéÿ≤ŸèŸàÿ±Ÿè", "ŸäŸèÿ≠Ÿêÿ®ŸëŸè"], hint: "ŸÅŸêÿπŸíŸÑ" }, // G√úNCELLENDƒ∞ (E≈ü Anlamlƒ±)
            { pre: "ŸáŸêŸäŸé", post: "ÿ¨ŸéÿØŸëŸéÿ™ŸéŸáÿß", a: "ÿ™Ÿéÿ≤ŸèŸàÿ±Ÿè", hint: "ŸÅŸêÿπŸíŸÑ" },
            { pre: "ÿ£ŸéŸÜŸéÿß", post: "ŸÅŸêŸä ÿßŸÑŸÖŸéÿ≥Ÿíÿ¨ŸêÿØ", a: "ÿ£ŸèÿµŸéŸÑŸëŸêŸä", hint: "ŸÅŸêÿπŸíŸÑ" }, 
            { pre: "ÿßŸÑÿ≥ŸëŸéÿßÿ¶ŸêŸÇŸè", post: "ÿßŸÑÿ≥ŸëŸéŸäŸëŸéÿßÿ±Ÿéÿ©", a: "ŸäŸéÿ≥ŸèŸàŸÇŸè", hint: "ŸÅŸêÿπŸíŸÑ" },
            { pre: "ÿßŸÑŸÖŸèŸÖŸéÿ±ŸëŸêÿ∂Ÿéÿ©Ÿè", post: "ÿ®ŸêÿßŸÑŸÖŸéÿ±Ÿíÿ∂ŸéŸâ", a: "ÿ™ŸéŸáŸíÿ™ŸéŸÖŸëŸè", hint: "ŸÅŸêÿπŸíŸÑ" },
            { pre: "ÿßŸÑŸÖŸèÿØŸéÿ±ŸëŸêÿ≥Ÿè", post: "ÿßŸÑÿ∑ŸëŸèŸÑŸëÿßÿ®", a: ["ŸäŸèÿØŸéÿ±ŸëŸêÿ≥Ÿè", "ŸäŸèÿπŸéŸÑŸëŸêŸÖŸè"], hint: "ŸÅŸêÿπŸíŸÑ" }, // E≈û ANLAMLI
            { pre: "ÿßŸÑÿ∑ŸëŸéÿ®ŸêŸäÿ®Ÿè", post: "ÿßŸÑŸÖŸéÿ±ŸêŸäÿ∂", a: "ŸäŸéŸÅŸíÿ≠ŸéÿµŸè", hint: "ŸÅŸêÿπŸíŸÑ" },
            { pre: "ŸäŸéÿ¨Ÿêÿ®Ÿè ÿ£ŸéŸÜŸí", post: "ÿµŸéÿßÿØŸêŸÇŸãÿß", a: ["ÿ™ŸéŸÉŸèŸàŸÜŸé", "ÿ£ŸéŸÉŸèŸàŸÜŸé"], hint: "ŸÅŸêÿπŸíŸÑ" }, 
        
            // Harfi Cerler (4)
            { pre: "ÿßŸÑÿ∑ŸëŸéÿ®ŸêŸäÿ®Ÿè ŸäŸéÿπŸíŸÖŸéŸÑŸè", post: "ÿßŸÑŸÖŸèÿ≥Ÿíÿ™Ÿéÿ¥ŸíŸÅŸéŸâ", a: "ŸÅŸêŸä", hint: "ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë" },
            { pre: "ÿ£ŸéŸÜŸéÿß ÿ£ŸéŸáŸíÿ™ŸéŸÖŸëŸè", post: "ÿßŸÑŸÖŸèŸàÿ≥ŸêŸäŸÇŸéŸâ", a: "ÿ®Ÿê", hint: "ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë" },
            { pre: "ÿßŸÑÿ∑ŸëŸéÿßŸÑŸêÿ®Ÿè ŸäŸéÿ∞ŸíŸáŸéÿ®Ÿè", post: "ÿßŸÑŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿê", a: "ÿ•ŸêŸÑŸéŸâ", hint: "ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë" },
            { pre: "ÿ±Ÿéÿ®ŸëŸéŸÜŸéÿß ÿßÿ∫ŸíŸÅŸêÿ±Ÿí", post: "ŸàŸéŸÑŸêŸàŸéÿßŸÑŸêÿØŸéŸäŸëŸé", a: "ŸÑŸêŸä", hint: ["ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë", "ÿ∂ŸéŸÖŸêŸäÿ±"] }, 

            // Mekanlar (ƒ∞sim) (3)
            { pre: "ŸäŸéÿπŸíŸÖŸéŸÑŸè ÿßŸÑÿ∑ŸëŸéÿ®ŸêŸäÿ®Ÿè ŸÅŸêŸä", post: "", a: "ÿßŸÑŸÖŸèÿ≥Ÿíÿ™Ÿéÿ¥ŸíŸÅŸéŸâ", hint: "ÿßŸêÿ≥ŸíŸÖ ŸÖŸéŸÉŸéÿßŸÜ" },
            { pre: "ŸäŸéÿπŸíŸÖŸéŸÑŸè ÿßŸÑŸÖŸèŸáŸéŸÜŸíÿØŸêÿ≥Ÿè ŸÅŸêŸä", post: "", a: "ÿßŸÑŸÖŸéÿµŸíŸÜŸéÿπŸê", hint: "ÿßŸêÿ≥ŸíŸÖ ŸÖŸéŸÉŸéÿßŸÜ" },
            { pre: "ŸäŸèÿµŸéŸÑŸëŸêŸä ÿßŸÑŸÖŸèÿ≥ŸíŸÑŸêŸÖŸèŸàŸÜŸé ŸÅŸêŸä", post: "", a: ["ÿßŸÑŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸê", "ÿßŸÑÿ¨ŸéÿßŸÖŸêÿπŸê"], hint: "ÿßŸêÿ≥ŸíŸÖ ŸÖŸéŸÉŸéÿßŸÜ" }, 

            // ƒ∞simler (4)
            { pre: "ÿ™Ÿéÿ®Ÿéÿ≥ŸëŸèŸÖŸèŸÉŸé ŸÅŸêŸä", post: "ÿ£ŸéÿÆŸêŸäŸÉŸé ÿµŸéÿØŸéŸÇŸéÿ©", a: "ŸàŸéÿ¨ŸíŸáŸê", hint: "ÿßŸêÿ≥ŸíŸÖ" },
            { pre: "ÿ¨Ÿéÿ≤ŸéÿßŸÉŸé ÿßŸÑŸÑŸëŸéŸáŸè", post: "", a: "ÿÆŸéŸäŸíÿ±Ÿãÿß", hint: "ÿßŸêÿ≥ŸíŸÖ" },
            { pre: "ÿ®ÿßÿ±ŸéŸÉŸé ÿßŸÑŸÑŸëŸéŸáŸè", post: "", a: "ŸÅŸêŸäŸÉŸé", hint: ["ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë", "ÿ∂ŸéŸÖŸêŸäÿ±"] }, 
            { pre: "ŸÉŸèŸÑŸëŸè ÿπŸéÿßŸÖŸç ŸàŸéÿ£ŸéŸÜŸíÿ™ŸèŸÖŸí", post: "", a: "ÿ®ŸêÿÆŸéŸäŸíÿ±Ÿç", hint: ["ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë", "ÿßŸêÿ≥ŸíŸÖ"] }
        ];


        // --- Gerekli Elementler ---
        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const progressDisplay = document.getElementById('progress-display');
        const progressBar = document.getElementById('progress-bar');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        
        const feedbackDetails = document.getElementById('feedback-details');
        const feedbackCorrectAnswer = document.getElementById('feedback-correct-answer');
        const feedbackOkButton = document.getElementById('feedback-ok-button');

        // --- Ses Deƒüi≈ükenleri ---
        let audioCtx = null;

        // --- Durum Deƒüi≈ükenleri ---
        let activityQueue = [];
        let currentActivityIndex = 0;
        let grandTotalActivities = 0;
        let scoreCorrect = 0;
        let scoreIncorrect = 0;

        // --- SES FONKSƒ∞YONLARI ---
        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(type) {
            if (!audioCtx) return; 
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            const now = audioCtx.currentTime;

            if (type === 'touch') {
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, now);
                oscillator.frequency.linearRampToValueAtTime(150, now + 0.3);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        }
        
        document.body.addEventListener('click', initAudioContext, { once: true });


        // --- Fisher-Yates Karƒ±≈ütƒ±rma Fonksiyonu ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // --- Hareke ve Alef Normalle≈ütirme Fonksiyonu ---
        function normalizeForCheck(text) {
            if (!text) return "";
            let newText = text.replace(/[\u064B-\u0652]/g, "");
            newText = newText.replace(/[ÿ£ÿ•ÿ¢]/g, "ÿß");
            return newText;
        }


        // --- Aktiviteleri (Bo≈üluk Doldurma) hazƒ±rla ---
        function createActivityQueue() {
            activityQueue = shuffle([...activitiesData]);
            grandTotalActivities = activityQueue.length;
        }

        // --- ETKƒ∞NLƒ∞K Y√úKLEYƒ∞Cƒ∞ (Bo≈üluk Doldurma) ---
        function loadActivity() {
            activityArea.innerHTML = '';
            updateProgress();
            
            const activityData = activityQueue[currentActivityIndex]; 
            
            instructionText.textContent = "ŸÇŸêŸäŸéŸÖŸä | ÿßŸèŸÖŸíŸÑŸéÿ£ ÿßŸÑŸíŸÅŸéÿ±ÿßÿ∫ ÿ®ŸêÿßŸÑŸíŸÉŸéŸÑŸêŸÖŸéÿ© ÿßŸÑŸÖŸèŸÜÿßÿ≥Ÿêÿ®Ÿéÿ©";
            
            buildFillInTheBlank(activityData);
        }
        
        // --- Bo≈üluk Doldurma Aray√ºz√ºn√º Olu≈ütur (√áOKLU ƒ∞PUCU G√úNCELLENDƒ∞) ---
        function buildFillInTheBlank(data) {
            const container = document.createElement('div');
            container.className = 'fill-in-blank-container';

            // 1. ƒ∞pucu √áubuƒüu
            const hintBar = document.createElement('div');
            hintBar.className = 'hint-bar';
            const hints = ["ÿ∂ŸéŸÖŸêŸäÿ±", "ŸÅŸêÿπŸíŸÑ", "ÿßŸêÿ≥ŸíŸÖ ŸÖŸéŸÉŸéÿßŸÜ", "ÿ≠Ÿéÿ±ŸíŸÅ ÿ¨Ÿéÿ±Ÿë", "ÿßŸêÿ≥ŸíŸÖ"]; 
            hints.forEach(hint => {
                const hintTag = document.createElement('span');
                hintTag.className = 'hint-tag';
                hintTag.id = `hint-${hint}`; 
                hintTag.textContent = hint;
                
                // --- YENƒ∞ VURGULAMA MANTIƒûI (Dƒ∞Zƒ∞ DESTEKLƒ∞) ---
                if (Array.isArray(data.hint)) {
                    if (data.hint.includes(hint)) {
                        hintTag.classList.add('active');
                    }
                } else {
                    if (data.hint === hint) {
                        hintTag.classList.add('active');
                    }
                }
                // --- Bƒ∞TTƒ∞ ---
                
                hintBar.appendChild(hintTag);
            });
            activityArea.appendChild(hintBar);


            // 2. Soru Metni
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            
            const preText = document.createElement('span');
            preText.textContent = data.pre;
            
            const answerInput = document.createElement('div');
            answerInput.id = 'answer-input';
            answerInput.className = 'answer-input';
            
            const postText = document.createElement('span');
            
            let postContent = data.post; 
            if (postContent !== "") {
                if (postContent.trim() !== '?' && postContent.trim() !== 'ÿü') {
                    postContent += " ."; 
                }
            }
            postText.textContent = postContent;
            
            questionText.appendChild(preText);
            questionText.appendChild(answerInput);
            questionText.appendChild(postText);
            
            container.appendChild(questionText);

            // 3. Klavye
            container.appendChild(buildKeyboard()); 
            
            // 4. Kontrol Butonlarƒ±
            const controls = document.createElement('div');
            controls.className = 'scramble-controls'; 
            
            const checkButton = document.createElement('button');
            checkButton.id = 'check-scramble-btn'; 
            checkButton.textContent = '‚úî ÿ™Ÿéÿ≠ŸéŸÇŸëŸéŸÇ';
            checkButton.onclick = () => {
                playSound('touch');
                checkFillInBlankAnswer(data.a); 
            };
            
            const resetButton = document.createElement('button');
            resetButton.id = 'reset-scramble-btn'; 
            resetButton.textContent = 'üîÑ ŸÖŸéÿ≥Ÿíÿ≠'; 
            resetButton.onclick = () => {
                playSound('touch');
                const input = document.getElementById('answer-input');
                if(input) input.textContent = ''; 
            };

            // YENƒ∞ SIRALAMA (Saƒüda Doƒürula, Solda Sƒ±fƒ±rla)
            controls.appendChild(checkButton);
            controls.appendChild(resetButton);
            
            container.appendChild(controls);
            
            activityArea.appendChild(container);
        }

        // --- Sanal Klavyeyi Olu≈ütur ---
        function buildKeyboard() {
            const keyboardContainer = document.createElement('div');
            keyboardContainer.className = 'keyboard-container';

            keyRows.forEach(row => {
                const keyRow = document.createElement('div');
                keyRow.className = 'key-row';
                
                row.forEach(keyText => {
                    const key = document.createElement('div');
                    key.className = 'key';
                    key.textContent = keyText;
                    
                    if (keyText === 'Backspace') {
                        key.classList.add('backspace');
                        key.innerHTML = '‚å´'; 
                        key.style.backgroundColor = backspaceBg;
                        key.style.boxShadow = `0 4px ${backspaceShadow}`;
                        
                        key.onclick = () => {
                            playSound('touch');
                            const answerInput = document.getElementById('answer-input');
                            if(answerInput) {
                                answerInput.textContent = answerInput.textContent.slice(0, -1);
                            }
                        };
                    } else {
                        const keyChar = keyText[0]; 
                        const color = colorMap[keyChar] || defaultColor;
                        key.style.backgroundColor = color;
                        key.style.boxShadow = `0 4px ${getDarkerColor(color)}`;
                        
                        key.onclick = () => {
                            playSound('touch');
                            const answerInput = document.getElementById('answer-input');
                            if(answerInput) {
                                answerInput.textContent += keyText;
                            }
                        };
                    }
                    keyRow.appendChild(key);
                });
                keyboardContainer.appendChild(keyRow);
            });
            
            return keyboardContainer;
        }


        // --- Bo≈üluk Doldurma Cevap Kontrol√º (Elif Lam Kontroll√º) ---
        function checkFillInBlankAnswer(correctAnswer) {
            const answerInput = document.getElementById('answer-input');
            const userAnswer = answerInput.textContent.trim();
            const normalizedUserAnswer = normalizeForCheck(userAnswer); 

            let isCorrect = false;
            
            const correctAnswers = Array.isArray(correctAnswer) ? correctAnswer : [correctAnswer];
            const normalizedCorrectAnswers = correctAnswers.map(normalizeForCheck); 

            for (const normCorrect of normalizedCorrectAnswers) { 
                
                // 1. Doƒürudan E≈üle≈üme Kontrol√º
                if (normalizedUserAnswer === normCorrect) { 
                    isCorrect = true;
                    break;
                }
                
                // 2. "ÿßŸÑ" Takƒ±sƒ± Eksikliƒüi Kontrol√º
                if (normCorrect.startsWith("ÿßŸÑ")) {
                    const answerWithoutAl = normCorrect.substring(2); 
                    if (normalizedUserAnswer === answerWithoutAl) { 
                        isCorrect = true;
                        break;
                    }
                }
            }

            showFeedback(isCorrect, correctAnswers[0]); 
            
            if (isCorrect) {
                scoreCorrect++;
            } else {
                scoreIncorrect++;
            }
        }


        // --- Geri Bildirim (‚úî / ‚ùå) - YENƒ∞ MANTIK ---
        function showFeedback(isCorrect, correctAnswer) {
            
            feedbackOverlay.classList.add('show');
            
            if (isCorrect) {
                feedbackIcon.textContent = '‚úî';
                feedbackIcon.className = 'correct';
                playSound('correct');
                
                feedbackDetails.style.display = 'none'; 
                
                setTimeout(nextActivity, 1200); 

            } else {
                feedbackIcon.textContent = '‚ùå';
                feedbackIcon.className = 'incorrect';
                playSound('incorrect');
                
                const answerToShow = (Array.isArray(correctAnswer) ? correctAnswer[0] : correctAnswer);
                                        
                feedbackCorrectAnswer.textContent = `ÿßŸÑŸíÿ¨ŸéŸàÿßÿ® ÿßŸÑÿµŸëŸéÿ≠Ÿäÿ≠: ${answerToShow}`;
                
                feedbackDetails.style.display = 'flex'; 
                
                feedbackOkButton.onclick = () => {
                    nextActivity(); 
                };
            }
        }

        // --- Sonraki Etkinliƒüe Ge√ßi≈ü (G√ºncellendi) ---
        function nextActivity() {
            feedbackOverlay.classList.remove('show');
            feedbackDetails.style.display = 'none'; 
            
            currentActivityIndex++; 

            if (currentActivityIndex === grandTotalActivities) {
                showFinishScreen();
            } else {
                loadActivity();
            }
        }

        // --- Biti≈ü Ekranƒ± ---
        function showFinishScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen">
                    <p>ÿ£Ÿéÿ≠Ÿíÿ≥ŸéŸÜŸíÿ™! ŸÑŸéŸÇŸéÿØ ÿ£ŸéŸÉŸíŸÖŸéŸÑŸíÿ™Ÿé ÿ¨ŸéŸÖŸäÿπ ÿßŸÑÿ£ŸéŸÜŸíÿ¥Ÿêÿ∑Ÿéÿ©‚Ä´.‚Ä¨</p>
                    
                    <div class="score-display">
                        <span class="score-item score-correct">‚úî ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">‚ùå ${scoreIncorrect}</span>
                    </div>

                    <button id="replay-button" onclick="restartGame()">üîÑ</button>
                </div>
            `;
            instructionText.textContent = "ÿßŸêŸÜŸíÿ™ŸéŸáŸéÿ™ ÿßŸÑÿ£ŸéŸÜŸíÿ¥Ÿêÿ∑Ÿéÿ©";
            progressDisplay.textContent = "ÿßŸêŸÉŸíÿ™ŸéŸÖŸéŸÑ";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }
        
        // --- Oyunu Yeniden Ba≈ülat Fonksiyonu ---
        function restartGame() {
            playSound('touch');
            
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentActivityIndex = 0;
            
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            
            createActivityQueue(); 
            loadActivity(); 
        }


        // --- ƒ∞lerleme G√ºncelleme ---
        function updateProgress() {
            if (grandTotalActivities === 0) {
                 progressDisplay.textContent = `0 / ${grandTotalActivities}`;
                 return;
            }
            
            if (currentActivityIndex === grandTotalActivities) return; 

            const currentTotal = currentActivityIndex + 1;
            const percentage = (currentActivityIndex / grandTotalActivities) * 100;
            
            progressDisplay.textContent = `${currentTotal} / ${grandTotalActivities}`;
            progressBar.style.width = `${percentage}%`;
        }
        
        // --- Ba≈ülangƒ±√ß ---
        document.addEventListener('DOMContentLoaded', () => {
            createActivityQueue();
            loadActivity();
        });

    </script>
</body>
</html>