<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚ÙÙŠÙÙ…ÙŠ - ØªÙ…Ø±ÙŠÙ† Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº</title>
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Temel Sayfa Stilleri --- */
        :root {
            --accent-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-light: #f8f9fa;
            /* GÃœNCELLENDÄ°: YazÄ± tipi deÄŸiÅŸtirildi */
            --font-arabic: 'Markazi Text', 'Tahoma', 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            font-weight: 400;
        }

        /* --- Ana Etkinlik AlanÄ± (16:9 ve 9:16) --- */
        .activity-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            width: 90vw;
            height: calc(90vw * 9 / 16); /* 16:9 */
            max-height: 90vh;
            max-width: calc(90vh * 16 / 9); /* 16:9 */
        }

        /* --- Tam Ekran Modu (100% GeniÅŸlik) --- */
        body.fullscreen .activity-container {
            width: 100vw;
            height: calc(100vw * 9 / 16); 
            max-height: 100vh;
            max-width: calc(100vh * 16 / 9);
            border-radius: 0;
            box-shadow: none;
        }

        
        /* --- Geri TuÅŸu (Header Ä°Ã§in) --- */
        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end; 
        }
        .back-button {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-button:hover {
            background: #e0e0e0;
        }
        .back-button svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }


        /* --- BaÅŸlÄ±k ve Ä°lerleme Ã‡ubuÄŸu (Simetrik 3 SÃ¼tun) --- */
        .header {
            padding: 15px 25px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            grid-template-areas: "progress instruction back"; 
            grid-template-columns: 310px 1fr 310px;
            align-items: center;
            gap: 20px;
        }
        
        #instruction-text { /* YÃ¶nerge (Ortada) */
            grid-area: instruction;
            text-align: center; 
            font-size: clamp(1.8rem, 2.2vw, 3rem); 
            font-weight: 700;
            color: #555;
        }
        
        .progress-container { /* Ä°lerleme Ã‡ubuÄŸu (SaÄŸda) */
            grid-area: progress;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: flex-start;
            width: 310px;
            direction: ltr; 
        }
        #progress-display {
            font-size: 1.5rem; 
            font-weight: bold;
            color: var(--accent-color);
            flex-shrink: 0;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.4s ease, background-color 0.4s ease;
        }

        /* --- Tam Ekran DÃ¼ÄŸmesi --- */
        #fullscreen-btn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px; /* DiÄŸerlerinden ayÄ±r */
            flex-shrink: 0; /* KÃ¼Ã§Ã¼lmesini engelle */
        }
        #fullscreen-btn:hover {
            background: #e0e0e0;
        }
        #fullscreen-btn svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }
        /* SVG Simgelerini gizle/gÃ¶ster */
        #fullscreen-btn .icon-open { display: block; }
        #fullscreen-btn .icon-close { display: none; }
        body.fullscreen #fullscreen-btn .icon-open { display: none; }
        body.fullscreen #fullscreen-btn .icon-close { display: block; }


        /* --- AsÄ±l Etkinlik AlanÄ± --- */
        .activity-area {
            flex-grow: 1;
            padding: 10px 20px; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            overflow-y: auto;
            padding-top: 15px; 
        }

        /* --- Soru Tipi: BoÅŸluk Doldurma --- */
        .fill-in-blank-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            justify-content: center; 
            padding-bottom: 20px; /* Klavyeye yer aÃ§ */
        }
        .question-text {
            font-size: clamp(2.5rem, 5vw, 6rem);
            font-weight: 700;
            color: #212529;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            line-height: 1.6;
            white-space: normal; 
            text-align: center;
        }
        .answer-input {
            font-size: clamp(2rem, 3.5vw, 4.5rem);
            font-weight: 700;
            font-family: var(--font-arabic);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 5px 15px;
            width: 300px;
            max-width: 80%;
            text-align: center;
            margin: 0 15px;
            min-height: clamp(50px, 8vh, 90px);
            background: #f8f9fa;
            direction: rtl; 
            color: #333;
        }
        
        /* --- Sanal Klavye --- */
        .keyboard-container {
            width: 100%;
            margin-top: 10px;
            direction: rtl; 
            user-select: none;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .key-row {
            display: flex;
            justify-content: center;
            /* GÃœNCELLENDÄ° (Talep 1) - BoÅŸluk azaltÄ±ldÄ± */
            gap: 0.8vw; 
            margin-bottom: 0.8vw;
        }
        .key {
            font-family: var(--font-arabic);
            /* GÃœNCELLENDÄ° (Talep 2) - Boyut artÄ±rÄ±ldÄ± */
            font-size: clamp(1.4rem, 2vw, 2.5rem);
            font-weight: 700;
            height: clamp(50px, 7vh, 75px);
            flex-grow: 1; 
            flex-basis: 0; 
            max-width: 80px; 
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
            border: none;
        }
        .key:active {
            transform: scale(0.95);
        }
        .key.backspace {
            /* GÃœNCELLENDÄ° (Talep 2) - Boyut artÄ±rÄ±ldÄ± */
            max-width: 110px; 
            font-size: 1.5rem;
            color: white;
        }

        /* --- Kontrol ButonlarÄ± --- */
        #check-scramble-btn, #reset-scramble-btn {
            padding: 15px 30px;
            font-size: 2rem; 
            font-family: var(--font-arabic);
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin: 5px;
        }
        #check-scramble-btn {
            background-color: var(--success-color);
            color: white;
        }
        #reset-scramble-btn {
            background-color: var(--danger-color);
            color: white;
        }
        .scramble-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }


        /* --- Geri Bildirim EkranÄ± (âœ” / âŒ) --- */
        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 15rem;
            z-index: 200;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .feedback-overlay.show {
            visibility: visible;
            opacity: 1;
        }
        .feedback-overlay .correct { color: var(--success-color); }
        .feedback-overlay .incorrect { color: var(--danger-color); }
        
        #feedback-details {
            display: none; 
            flex-direction: column;
            align-items: center;
            position: absolute;
            bottom: 5%; 
            width: 100%;
        }
        #feedback-correct-answer {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            background: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        #feedback-ok-button {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            background-color: var(--success-color);
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* --- BitiÅŸ EkranÄ± (ve Tur BitiÅŸ EkranÄ±) --- */
        #finish-screen {
            text-align: center;
            font-weight: 700;
            color: var(--accent-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        #finish-screen p {
            font-size: 3.5rem; 
            margin: 10px 0;
        }
        .score-display {
            display: flex;
            gap: 30px;
            font-size: 2.8rem; 
            margin: 10px 0; /* AyarlandÄ± */
            direction: ltr;
        }
        .score-item {
            font-weight: 700;
        }
        .score-correct {
            color: var(--success-color);
        }
        .score-incorrect {
            color: var(--danger-color);
        }
        #replay-button {
            font-size: 4.5rem; 
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        #replay-button:hover {
            transform: rotate(-90deg);
            background-color: #f0f0f0;
        }
        
        /* --- Mobil DÃ¼zen --- */
        @media (orientation: portrait) {
            .activity-container {
                width: 95vw;
                height: calc(95vw * 16 / 9); /* 9:16 */
                max-height: 95vh;
                max-width: calc(95vh * 9 / 16); /* 9:16 */
            }

            body.fullscreen .activity-container {
                width: 100vw;
                height: calc(100vw * 16 / 9);
                max-height: 100vh;
                max-width: calc(100vh * 9 / 16);
            }

            .header {
                grid-template-areas: 
                    "progress back"
                    "instruction instruction";
                grid-template-columns: 1fr 1fr; 
                gap: 10px;
                padding: 10px 15px;
            }

            .progress-container {
                width: auto; 
                justify-content: flex-start;
            }
            .back-button-container {
                justify-content: flex-end;
            }
            #instruction-text {
                min-width: unset;
                justify-self: center;
            }
            #progress-display {
                font-size: 1.2rem; 
            }
            
            /* Mobil: BoÅŸluk Doldurma ve Klavye */
            .fill-in-blank-container {
                justify-content: flex-start; /* Dikeyde daha iyi yerleÅŸim iÃ§in */
                padding-top: 10px;
            }
            .question-text { 
                line-height: 1.5;
                margin-bottom: 10px; /* AzaltÄ±ldÄ± */
            }
            .answer-input { 
                width: 200px;
            }
            .keyboard-container { margin-top: 5px; }
            .key { 
                border-radius: 5px;
            }
            .key.backspace { font-size: 1rem; }
            .scramble-controls { margin-top: 5px; }
            #check-scramble-btn, #reset-scramble-btn {
                font-size: 1.5rem; 
                padding: 10px 20px;
            }
            
            /* Mobil: Geri bildirim */
            #feedback-correct-answer {
                font-size: 1.5rem;
            }
            #feedback-ok-button {
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
                margin-top: 10px;
            }
        }

    </style>
</head>
<body>

    <div class="activity-container">
        
        <div class="header">
            <div class="progress-container">
                <button id="fullscreen-btn">
                    <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 10h2V7h3V5H5v5zM14 5v2h3v3h2V5h-5zM5 19v-5h2v3h3v2H5zM14 19v-2h3v-3h2v5h-5z"/>
                    </svg>
                    <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>
                </button>

                <div id="progress-display">...</div> 
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
            
            <div id="instruction-text">...</div>

            <div class="back-button-container">
                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="activity-area" id="activity-area">
            </div>

        <div class="feedback-overlay" id="feedback-overlay">
            <span id="feedback-icon"></span>
            
            <div id="feedback-details">
                <div id="feedback-correct-answer"></div>
                <button id="feedback-ok-button">âœ”</button>
            </div>
        </div>

    </div>

    <script>
        // --- KLAVYE TASARIMI (KullanÄ±cÄ±dan Gelen) ---
        const colorMap={'Ø¨':'#a0c4ff','Øª':'#a0c4ff','Ø«':'#a0c4ff','Ù†':'#a0c4ff','ÙŠ':'#a0c4ff','Ø¬':'#caffbf','Ø­':'#caffbf','Ø®':'#caffbf','Ø¯':'#fdffb6','Ø°':'#fdffb6','Ø±':'#ffd6a5','Ø²':'#ffd6a5','Ø³':'#ffadad','Ø´':'#ffadad','Øµ':'#bdb2ff','Ø¶':'#bdb2ff','Ø·':'#9bf6ff','Ø¸':'#9bf6ff','Ø¹':'#ffc6ff','Øº':'#ffc6ff','Ù':'#b9f6ca','Ù‚':'#b9f6ca','Ù‡':'#b3e5fc','Ø©':'#b3e5fc','Ø¡':'#ffccbc','Ø¤':'#ffccbc','Ø¦':'#ffccbc','Ø§':'#e0e0e0','Ù„':'#e0e0e0','Ùƒ':'#d1c4e9','Ù…':'#f8bbd0','Ùˆ':'#c5cae9'};
        const defaultColor='#FFFFFF';
        const backspaceBg = '#E53935';
        
        function getDarkerColor(hex) {
            if (!hex || hex === '#FFFFFF') hex = '#CCCCCC'; 
            if (hex.length === 4) { 
                hex = `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`;
            }
            
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            
            r = Math.floor(r * 0.85); 
            g = Math.floor(g * 0.85);
            b = Math.floor(b * 0.85);
            
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }
        
        const backspaceShadow = getDarkerColor(backspaceBg);
        
        const keyRows = [
            ["Ø¯","Ø¬","Ø­","Ø®","Ù‡","Ø¹","Øº","Ù","Ù‚","Ø«","Øµ","Ø¶"],
            ["Ø·","Ùƒ","Ù…","Ù†","Øª","Ø§","Ù„","Ø¨","ÙŠ","Ø³","Ø´","Ø°"],
            ["Backspace", "Ø¸","Ø²","Ùˆ","Ø©","Ù‰","Ø±","Ø¤","Ø¡","Ø¦"] 
        ];

        // --- Harekeleri GÃ¼ncellenmiÅŸ Veri ---
        const activitiesData = [
            // Zamirler (9)
            { pre: "", post: "ÙŠÙØ°Ù’Ù‡ÙØ¨ÙˆÙ†Ù Ø¥ÙÙ„Ù‰ Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯", a: "Ù‡ÙÙ…", hint: "Ø¶ÙÙ…ÙŠØ±" },
            { pre: "", post: "ÙŠÙÙƒÙ’Ø±ÙÙ…Ù’Ù†Ù Ø§Ù„Ø¶Ù‘ÙÙŠÙˆÙ", a: "Ù‡ÙÙ†Ù‘Ù", hint: "Ø¶ÙÙ…ÙŠØ±" },
            { pre: "", post: "ÙŠÙØ¹Ù’Ù…ÙÙ„Ø§Ù†Ù ÙÙŠ Ø§Ù„Ù…ÙØµÙ’Ù†ÙØ¹", a: "Ù‡ÙÙ…Ø§", hint: "Ø¶ÙÙ…ÙŠØ±" },
            { pre: "", post: "Ù†ÙØ­Ù’ØªÙØ±ÙÙ…Ù Ø§Ù„ÙƒÙØ¨Ø§Ø±", a: "Ù†ÙØ­Ù’Ù†Ù", hint: "Ø¶ÙÙ…ÙŠØ±" },
            { pre: "", post: "ÙŠÙØ¹Ù’Ù…ÙÙ„Ù ÙÙŠ Ø§Ù„Ù…ÙØµÙ’Ù†ÙØ¹", a: ["Ù‡ÙÙˆ", "Ø§Ù„Ø¹Ø§Ù…ÙÙ„"], hint: "Ø¶ÙÙ…ÙÙŠØ±" },
            { pre: "", post: "ØªÙØ¹Ù’Ù…ÙÙ„Ù ÙÙŠ Ø§Ù„Ù…ÙØ³Ù’ØªÙØ´Ù’ÙÙ‰", a: ["Ù‡ÙÙŠÙ", "Ø£ÙÙ†Ù’ØªÙ"], hint: "Ø¶ÙÙ…ÙÙŠØ±" }, 
            { pre: "", post: "ØªÙØ­Ù’ØªÙØ±ÙÙ…Ù Ø§Ù„ÙƒÙØ¨Ø§Ø±", a: ["Ø£ÙÙ†Ù’ØªÙ", "Ù‡ÙÙŠÙ"], hint: "Ø¶ÙÙ…ÙÙŠØ±" }, 
            { pre: "", post: "Ø£ÙØ­ÙØ¨Ù‘Ù Ø£ÙÙ‚Ø§Ø±ÙØ¨ÙŠ", a: "Ø£ÙÙ†Ø§", hint: "Ø¶ÙÙ…ÙŠØ±" },
            { pre: "", post: "ØªÙØ­Ù’ØªÙØ±ÙÙ…ÙˆÙ†Ù Ø§Ù„ÙƒÙØ¨Ø§Ø±", a: "Ø£ÙÙ†Ù’ØªÙÙ…", hint: "Ø¶ÙÙ…ÙIR" },

            // Fiil Ã‡ekimleri (10)
            { pre: "Ù‡ÙÙ…", post: "Ø¥ÙÙ„Ù‰ Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯", a: "ÙŠÙØ°Ù’Ù‡ÙØ¨ÙˆÙ†Ù", hint: "ÙÙØ¹Ù’Ù„" },
            { pre: "Ù‡ÙÙ†Ù‘Ù", post: "Ø§Ù„Ø¶Ù‘ÙÙŠÙˆÙ", a: "ÙŠÙÙƒÙ’Ø±ÙÙ…Ù’Ù†Ù", hint: "ÙÙØ¹Ù’Ù„" },
            { pre: "Ù‡ÙÙˆ", post: "Ø£ÙÙ‚Ø§Ø±ÙØ¨ÙÙ‡Ù", a: ["ÙŠÙØ²ÙˆØ±Ù", "ÙŠÙØ­ÙØ¨Ù‘Ù"], hint: "ÙÙØ¹Ù’Ù„" }, 
            { pre: "Ù‡ÙÙŠ", post: "Ø¬ÙØ¯Ù‘ÙØªÙÙ‡Ø§", a: ["ØªÙØ²ÙˆØ±Ù", "ØªÙØ­ÙØ¨Ù‘Ù"], hint: "ÙÙØ¹Ù’Ù„" },
            { pre: "Ø£ÙÙ†Ø§", post: "ÙÙŠ Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯", a: "Ø£ÙØµÙÙ„Ù‘ÙŠ", hint: "ÙÙØ¹Ù’Ù„" }, 
            { pre: "Ø§Ù„Ø³Ù‘ÙØ§Ø¦ÙÙ‚", post: "Ø§Ù„Ø³Ù‘ÙÙŠÙ‘Ø§Ø±ÙØ©", a: "ÙŠÙØ³ÙˆÙ‚Ù", hint: "ÙÙØ¹Ù’Ù„" },
            { pre: "Ø§Ù„Ù…ÙÙ…ÙØ±Ù‘ÙØ¶ÙØ©", post: "Ø¨ÙØ§Ù„Ù…ÙØ±Ù’Ø¶Ù‰", a: "ØªÙÙ‡Ù’ØªÙÙ…Ù‘Ù", hint: "ÙÙØ¹Ù’Ù„" },
            { pre: "Ø§Ù„Ù…ÙØ¯ÙØ±Ù‘ÙØ³", post: "Ø§Ù„Ø·Ù‘ÙÙ„Ù‘Ø§Ø¨", a: ["ÙŠÙØ¯ÙØ±Ù‘ÙØ³Ù", "ÙŠÙØ¹ÙÙ„Ù‘ÙÙ…Ù", "ÙŠÙØ­ÙØ¨Ù‘Ù"], hint: "ÙÙØ¹Ù’Ù„" }, 
            { pre: "Ø§Ù„Ø·Ù‘ÙØ¨ÙŠØ¨", post: "Ø§Ù„Ù…ÙØ±ÙŠØ¶", a: "ÙŠÙÙÙ’Ø­ÙØµÙ", hint: "ÙÙØ¹Ù’Ù„" },
            { pre: "ÙŠÙØ¬ÙØ¨Ù Ø£ÙÙ†Ù’", post: "ØµØ§Ø¯ÙÙ‚Ù‹Ø§", a: ["ØªÙÙƒÙÙˆÙ†Ù", "Ø£ÙÙƒÙÙˆÙ†Ù"], hint: "ÙÙØ¹Ù’Ù„" }, 
        
            // Harfi Cerler (4)
            { pre: "Ø§Ù„Ø·Ù‘ÙØ¨ÙŠØ¨ ÙŠÙØ¹Ù’Ù…ÙÙ„", post: "Ø§Ù„Ù…ÙØ³Ù’ØªÙØ´Ù’ÙÙ‰", a: "ÙÙŠ", hint: "Ø­ÙØ±Ù’Ù Ø¬ÙØ±Ù‘" },
            { pre: "Ø£ÙÙ†Ø§ Ø£ÙÙ‡Ù’ØªÙÙ…Ù‘Ù", post: "Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰", a: "Ø¨Ù", hint: "Ø­ÙØ±Ù’Ù Ø¬ÙØ±Ù‘" },
            { pre: "Ø§Ù„Ø·Ù‘Ø§Ù„ÙØ¨ ÙŠÙØ°Ù’Ù‡ÙØ¨Ù", post: "Ø§Ù„Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©", a: "Ø¥ÙÙ„Ù‰", hint: "Ø­ÙØ±Ù’Ù Ø¬ÙØ±Ù‘" },
            { pre: "Ø±ÙØ¨Ù‘ÙÙ†ÙØ§ Ø§ØºÙ’ÙÙØ±Ù’", post: "ÙˆÙÙ„ÙÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ‘Ù", a: "Ù„ÙÙŠ", hint: ["Ø­ÙØ±Ù’Ù Ø¬ÙØ±Ù‘", "Ø¶ÙÙ…ÙÙŠØ±"] }, 

            // Mekanlar (Ä°sim) (3)
            { pre: "ÙŠÙØ¹Ù’Ù…ÙÙ„Ù Ø§Ù„Ø·Ù‘ÙØ¨ÙŠØ¨ ÙÙŠ", post: "", a: "Ø§Ù„Ù…ÙØ³Ù’ØªÙØ´Ù’ÙÙ‰", hint: "Ø§ÙØ³Ù’Ù… Ù…ÙÙƒØ§Ù†" },
            { pre: "ÙŠÙØ¹Ù’Ù…ÙÙ„Ù Ø§Ù„Ù…ÙÙ‡ÙÙ†Ù’Ø¯ÙØ³ ÙÙŠ", post: "", a: ["Ø§Ù„Ù…ÙØµÙ’Ù†ÙØ¹", "Ø§Ù„Ø´Ù‘ÙØ±ÙÙƒÙØ©"], hint: "Ø§ÙØ³Ù’Ù… Ù…ÙÙƒØ§Ù†" },
            { pre: "ÙŠÙØµÙÙ„Ù‘ÙŠ Ø§Ù„Ù…ÙØ³Ù’Ù„ÙÙ…ÙˆÙ† ÙÙŠ", post: "", a: ["Ø§Ù„Ù…ÙØ³Ù’Ø¬ÙØ¯", "Ø§Ù„Ø¬Ø§Ù…ÙØ¹"], hint: "Ø§ÙØ³Ù’Ù… Ù…ÙÙƒØ§Ù†" }, 

            // Ä°simler (4)
            { pre: "ØªÙØ¨ÙØ³Ù‘ÙÙ…ÙÙƒÙ ÙÙÙŠ", post: "Ø£ÙØ®ÙÙŠÙƒÙ ØµÙØ¯ÙÙ‚ÙØ©", a: "ÙˆÙØ¬Ù’Ù‡Ù", hint: "Ø§ÙØ³Ù’Ù…" },
            { pre: "Ø¬ÙØ²Ø§Ùƒ Ø§Ù„Ù„Ù‡", post: "", a: "Ø®ÙÙŠÙ’Ø±Ù‹Ø§", hint: "Ø§ÙØ³Ù’Ù…" },
            { pre: "Ø¨Ø§Ø±ÙÙƒÙ Ø§Ù„Ù„Ù‡", post: "", a: "ÙÙŠÙƒ", hint: ["Ø­ÙØ±Ù’Ù Ø¬ÙØ±Ù‘", "Ø¶ÙÙ…ÙÙŠØ±"] }, 
            { pre: "ÙƒÙÙ„Ù‘ Ø¹Ø§Ù… ÙˆÙØ£ÙÙ†Ù’ØªÙÙ…", post: "", a: "Ø¨ÙØ®ÙÙŠÙ’Ø±", hint: ["Ø­ÙØ±Ù’Ù Ø¬ÙØ±Ù‘", "Ø§ÙØ³Ù’Ù…"] }
        ];


        // --- Gerekli Elementler ---
        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const progressDisplay = document.getElementById('progress-display');
        const progressBar = document.getElementById('progress-bar');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        
        const feedbackDetails = document.getElementById('feedback-details');
        const feedbackCorrectAnswer = document.getElementById('feedback-correct-answer');
        const feedbackOkButton = document.getElementById('feedback-ok-button');
        const fullscreenButton = document.getElementById('fullscreen-btn');

        // --- Ses DeÄŸiÅŸkenleri ---
        let audioCtx = null;

        // --- Durum DeÄŸiÅŸkenleri (10'luk sistem) ---
        let allActivitiesData = [];     
        let activityQueue = [];         
        let currentActivityIndex = 0;   
        let grandTotalActivities = 0;   
        let currentRound = 0;           
        const questionsPerRound = 10;   
        let totalRounds = 0;            
        let totalQuestionsInGame = 0;   
        let scoreCorrect = 0;      
        let scoreIncorrect = 0;    

        // --- SES FONKSÄ°YONLARI ---
        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(type) {
            if (!audioCtx) return; 
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            const now = audioCtx.currentTime;

            if (type === 'touch') {
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, now);
                oscillator.frequency.linearRampToValueAtTime(150, now + 0.3);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        }
        
        document.body.addEventListener('click', function() {
            initAudioContext();
            /*
            if (!document.fullscreenElement) {
                 toggleFullScreen(); // Otomatik tam ekran istenirse bu satÄ±r aÃ§Ä±labilir
            }
            */
        }, { once: true });


        // --- Tam Ekran FonksiyonlarÄ± ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
        
        function checkFullScreen() {
             if (document.fullscreenElement) {
                document.body.classList.add('fullscreen');
             } else {
                document.body.classList.remove('fullscreen');
             }
        }
        
        if(fullscreenButton) {
            fullscreenButton.addEventListener('click', toggleFullScreen);
        }
        document.addEventListener('fullscreenchange', checkFullScreen);


        // --- Fisher-Yates KarÄ±ÅŸtÄ±rma Fonksiyonu ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // --- Hareke ve Alef NormalleÅŸtirme Fonksiyonu ---
        function normalizeForCheck(text) {
            if (!text) return "";
            let newText = text.replace(/[\u064B-\u065F]/g, ""); 
            newText = newText.replace(/[Ø£Ø¥Ø¢]/g, "Ø§");
            newText = newText.replace(/[Ù‰]/g, "ÙŠ"); 
            return newText;
        }
        
        // --- Soru metni sÄ±ÄŸdÄ±rma fonksiyonu ---
        function adjustFontSize(element) {
            element.style.fontSize = '';
            element.style.whiteSpace = 'normal';

            const baseFontSize = parseFloat(window.getComputedStyle(element).fontSize);
            const currentHeight = element.clientHeight;

            if (currentHeight > baseFontSize * 1.7) { 
                
                element.style.whiteSpace = 'nowrap';
                let currentFontSize = baseFontSize;

                while (element.scrollWidth > element.clientWidth && currentFontSize > 16) {
                    currentFontSize -= 1; 
                    element.style.fontSize = currentFontSize + 'px';
                }
            }
        }


        // --- ETKÄ°NLÄ°K YÃœKLEYÄ°CÄ° ---
        function loadActivity() {
            activityArea.innerHTML = '';
            updateProgress(); 
            
            const activityData = activityQueue[currentActivityIndex]; 
            
            instructionText.textContent = "Ù‚ÙÙŠÙÙ…ÙŠ | Ø§ÙÙ…Ù’Ù„ÙØ£ Ø§Ù„ÙÙØ±Ø§Øº Ø¨ÙØ§Ù„ÙƒÙÙ„ÙÙ…ÙØ© Ø§Ù„Ù…ÙÙ†Ø§Ø³ÙØ¨ÙØ©â€«.â€¬";
            
            buildFillInTheBlank(activityData);
        }
        
        // --- BoÅŸluk Doldurma ArayÃ¼zÃ¼nÃ¼ OluÅŸtur ---
        function buildFillInTheBlank(data) {
            const container = document.createElement('div');
            container.className = 'fill-in-blank-container';

            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            
            const preText = document.createElement('span');
            preText.textContent = data.pre;
            
            const answerInput = document.createElement('div');
            answerInput.id = 'answer-input';
            answerInput.className = 'answer-input';
            
            const postText = document.createElement('span');
            
            let postContent = data.post; 
            if (postContent === "") {
                postContent = "."; 
            } else {
                if (postContent.trim() !== '?' && postContent.trim() !== 'ØŸ') {
                    postContent = " " + postContent + "."; 
                } else {
                    postContent = " " + postContent;
                }
            }
            postText.textContent = postContent;
            
            questionText.appendChild(preText);
            questionText.appendChild(answerInput);
            questionText.appendChild(postText);
            
            container.appendChild(questionText);
            
            adjustFontSize(questionText);

            container.appendChild(buildKeyboard()); 
            
            const controls = document.createElement('div');
            controls.className = 'scramble-controls'; 
            
            const checkButton = document.createElement('button');
            checkButton.id = 'check-scramble-btn';
            checkButton.textContent = 'âœ” ØªÙØ­ÙÙ‚ÙÙ‘Ù‚Ù’';
            checkButton.onclick = () => {
                playSound('touch');
                checkFillInBlankAnswer(data.a); 
            };
            
            const resetButton = document.createElement('button');
            resetButton.id = 'reset-scramble-btn'; 
            resetButton.textContent = 'ğŸ”„ Ù…ÙØ³Ù’Ø­'; 
            resetButton.onclick = () => {
                playSound('touch');
                const input = document.getElementById('answer-input');
                if(input) input.textContent = ''; 
            };

            controls.appendChild(checkButton);
            controls.appendChild(resetButton);
            
            container.appendChild(controls);
            
            activityArea.appendChild(container);
        }

        // --- Sanal Klavyeyi OluÅŸtur ---
        function buildKeyboard() {
            const keyboardContainer = document.createElement('div');
            keyboardContainer.className = 'keyboard-container';

            keyRows.forEach(row => {
                const keyRow = document.createElement('div');
                keyRow.className = 'key-row';
                
                row.forEach(keyText => {
                    const key = document.createElement('div');
                    key.className = 'key';
                    key.textContent = keyText;
                    
                    if (keyText === 'Backspace') {
                        key.classList.add('backspace');
                        key.innerHTML = 'âŒ«'; 
                        key.style.backgroundColor = backspaceBg;
                        key.style.boxShadow = `0 4px ${backspaceShadow}`;
                        
                        key.onclick = () => {
                            playSound('touch');
                            const answerInput = document.getElementById('answer-input');
                            if(answerInput) {
                                answerInput.textContent = answerInput.textContent.slice(0, -1);
                            }
                        };
                    } else {
                        const keyChar = keyText[0]; 
                        const color = colorMap[keyChar] || defaultColor;
                        key.style.backgroundColor = color;
                        key.style.boxShadow = `0 4px ${getDarkerColor(color)}`;
                        
                        key.onclick = () => {
                            playSound('touch');
                            const answerInput = document.getElementById('answer-input');
                            if(answerInput) {
                                answerInput.textContent += keyText;
                            }
                        };
                    }
                    keyRow.appendChild(key);
                });
                keyboardContainer.appendChild(keyRow);
            });
            
            return keyboardContainer;
        }


        // --- BoÅŸluk Doldurma Cevap KontrolÃ¼ ---
        function checkFillInBlankAnswer(correctAnswer) {
            const answerInput = document.getElementById('answer-input');
            const userAnswer = answerInput.textContent.trim();
            const normalizedUserAnswer = normalizeForCheck(userAnswer); 

            let isCorrect = false;
            
            const correctAnswers = Array.isArray(correctAnswer) ? correctAnswer : [correctAnswer];
            const normalizedCorrectAnswers = correctAnswers.map(normalizeForCheck); 

            for (const normCorrect of normalizedCorrectAnswers) { 
                
                if (normalizedUserAnswer === normCorrect) { 
                    isCorrect = true;
                    break;
                }
                
                if (normCorrect.startsWith("Ø§Ù„")) {
                    const answerWithoutAl = normCorrect.substring(2); 
                    if (normalizedUserAnswer === answerWithoutAl) { 
                        isCorrect = true;
                        break;
                    }
                }
            }

            showFeedback(isCorrect, correctAnswers[0]); 
            
            if (isCorrect) {
                scoreCorrect++;
            } else {
                scoreIncorrect++;
            }
        }


        // --- Geri Bildirim (âœ” / âŒ) ---
        function showFeedback(isCorrect, correctAnswer) {
            
            feedbackOverlay.classList.add('show');
            
            if (isCorrect) {
                feedbackIcon.textContent = 'âœ”';
                feedbackIcon.className = 'correct';
                playSound('correct');
                
                feedbackDetails.style.display = 'none'; 
                
                setTimeout(nextActivity, 1200); 

            } else {
                feedbackIcon.textContent = 'âŒ';
                feedbackIcon.className = 'incorrect';
                playSound('incorrect');
                
                const answerToShow = (Array.isArray(correctAnswer) ? correctAnswer[0] : correctAnswer);
                                        
                feedbackCorrectAnswer.textContent = `Ø§Ù„Ù’Ø¬ÙÙˆØ§Ø¨ Ø§Ù„ØµÙ‘ÙØ­ÙŠØ­: ${answerToShow}`;
                
                feedbackDetails.style.display = 'flex'; 
                
                feedbackOkButton.onclick = () => {
                    nextActivity(); 
                };
            }
        }

        // --- Sonraki EtkinliÄŸe GeÃ§iÅŸ ---
        function nextActivity() {
            feedbackOverlay.classList.remove('show');
            feedbackDetails.style.display = 'none'; 
            
            currentActivityIndex++; 

            if (currentActivityIndex === grandTotalActivities) {
                if (currentRound === totalRounds) {
                    showFinishScreen();
                } else {
                    showRoundCompleteScreen();
                }
            } else {
                loadActivity();
            }
        }

        // --- BitiÅŸ EkranÄ± (Oyun BittiÄŸinde) ---
        function showFinishScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen">
                    <p>Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª! Ù„ÙÙ‚ÙØ¯ Ø£ÙÙƒÙ’Ù…ÙÙ„Ù’ØªÙ Ø¬ÙÙ…ÙŠØ¹ Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©â€«.â€¬</p>
                    
                    <p style="font-size: 2.5rem; color: #555; margin-bottom: 0;">Ø§Ù„Ù†Ù‘ÙØªÙÙŠØ¬ÙØ©Ù Ø§Ù„Ù†Ù‘ÙÙ‡ÙØ§Ø¦ÙÙŠÙ‘ÙØ©:</p>
                    <div class="score-display">
                        <span class="score-item score-correct">âœ” ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">âŒ ${scoreIncorrect}</span>
                    </div>

                    <button id="replay-button" onclick="restartGame()">ğŸ”„</button>
                </div>
            `;
            instructionText.textContent = "Ø§ÙÙ†Ù’ØªÙÙ‡ÙØª Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©";
            progressDisplay.textContent = "Ø§ÙÙƒÙ’ØªÙÙ…ÙÙ„";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }

        // --- 10 Soru BitiÅŸ EkranÄ± ---
        function showRoundCompleteScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen" style="justify-content: center;">
                    <p>Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª!</p>
                    
                    <p style="font-size: 2.5rem; color: #555; margin-bottom: 0;">Ù†ÙØªÙŠØ¬ÙØ© Ù‡ÙØ°ÙÙ‡Ù Ø§Ù„Ø¬ÙÙˆÙ’Ù„ÙØ©</p>
                    <div class="score-display">
                        <span class="score-item score-correct">âœ” ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">âŒ ${scoreIncorrect}</span>
                    </div>

                    <button id="check-scramble-btn" onclick="startNextRound()" style="font-size: 1.8rem; margin-top: 20px;">
                        Ø§Ù„ØªÙ‘ÙØ§Ù„ÙÙŠ â†
                    </button>
                </div>
            `;
            instructionText.textContent = "Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª!";
            progressDisplay.textContent = "Ø§ÙÙƒÙ’ØªÙÙ…ÙÙ„";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }

        // --- Sonraki 10'lu BloÄŸu BaÅŸlat ---
        function startNextRound() {
            playSound('touch');

            scoreCorrect = 0;
            scoreIncorrect = 0;

            currentRound++;
            currentActivityIndex = 0;
            
            const roundStartIndex = (currentRound - 1) * questionsPerRound;
            const roundEndIndex = Math.min(currentRound * questionsPerRound, totalQuestionsInGame);
            
            activityQueue = allActivitiesData.slice(roundStartIndex, roundEndIndex);
            grandTotalActivities = activityQueue.length;
            
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            
            loadActivity(); 
        }

        
        // --- Oyunu Yeniden BaÅŸlat Fonksiyonu ---
        function restartGame() {
            playSound('touch');
            
            scoreCorrect = 0;
            scoreIncorrect = 0;
            
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            
            allActivitiesData = shuffle([...activitiesData]);
            totalQuestionsInGame = allActivitiesData.length;
            totalRounds = Math.ceil(totalQuestionsInGame / questionsPerRound);
            currentRound = 0; 
            
            startNextRound(); 
        }


        // --- Ä°lerleme GÃ¼ncelleme ---
        function updateProgress() {
            if (grandTotalActivities === 0) {
                 progressDisplay.textContent = `0 / ${grandTotalActivities}`;
                 return;
            }
            
            const currentTotal = currentActivityIndex + 1;
            const percentage = (currentActivityIndex / grandTotalActivities) * 100;
            
            progressDisplay.textContent = `${currentTotal} / ${grandTotalActivities}`;
            progressBar.style.width = `${percentage}%`;
        }
        
        // --- BaÅŸlangÄ±Ã§ ---
        document.addEventListener('DOMContentLoaded', () => {
            allActivitiesData = shuffle([...activitiesData]);
            totalQuestionsInGame = allActivitiesData.length;
            totalRounds = Math.ceil(totalQuestionsInGame / questionsPerRound);
            
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentRound = 0; 
            
            startNextRound(); 

            checkFullScreen();
        });

    </script>
</body>
</html>