<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚ÙÙŠÙÙ…ÙŠ - ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªØµÙ†ÙŠÙ</title>
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Temel Sayfa Stilleri --- */
        :root {
            --accent-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-light: #f8f9fa;
            --font-arabic: 'Markazi Text', 'Tahoma', 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            font-weight: 400;
        }

        /* --- Ana Etkinlik AlanÄ± (16:9 ve 9:16) --- */
        .activity-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            width: 90vw;
            height: calc(90vw * 9 / 16); /* 16:9 */
            max-height: 90vh;
            max-width: calc(90vh * 16 / 9); /* 16:9 */
        }
        
        /* --- Geri TuÅŸu (Header Ä°Ã§in) --- */
        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end; 
            align-items: center; /* DÃ¼ÄŸmeleri dikeyde hizala */
        }
        .back-button {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; /* KÃ¼Ã§Ã¼lmesin */
        }
        .back-button:hover {
            background: #e0e0e0;
        }
        .back-button svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }


        /* --- BaÅŸlÄ±k --- */
        .header {
            padding: 15px 25px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            grid-template-areas: "instruction back"; 
            grid-template-columns: 1fr auto; 
            align-items: center;
            gap: 20px;
            flex-shrink: 0; /* Header kÃ¼Ã§Ã¼lmesin */
        }
        
        #instruction-text {
            grid-area: instruction;
            text-align: right; 
            font-size: 2.2rem; 
            font-weight: 700;
            color: #555;
        }
        

        /* --- AsÄ±l Etkinlik AlanÄ± --- */
        .activity-area {
    flex-grow: 1;
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center; /* <-- YENÄ° (Dikey ortalama) */
    align-items: center;     /* <-- YENÄ° (Yatay ortalama) */
    overflow: hidden; /* Ä°Ã§erik taÅŸmasÄ±n */
    }

        /* --- SÄ±nÄ±flandÄ±rma Stilleri --- */
        .categorize-container {
    display: flex;
    flex-direction: row-reverse; /* RTL iÃ§in saÄŸ (bank) sola (kutu) */
    width: 100%;  /* <-- 90%'dan DEÄÄ°ÅTÄ° */
    height: 100%; /* <-- 90%'dan DEÄÄ°ÅTÄ° */
    gap: 15px;
      }

        /* Sol taraf (Izgara) */
        .drop-zones-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 SÃ¼tun */
            gap: 15px;
            flex: 1; /* Kalan alanÄ± doldur */
            overflow-y: auto; /* Gerekirse kaydÄ±r */
            padding: 5px;
        }

        .category-drop-zone {
            background-color: var(--bg-light);
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            padding: 10px;
            min-height: 150px;
            
            /* Kutu iÃ§i kelime dÃ¼zeni */
            display: flex;
            flex-wrap: wrap;
            gap: 6px; 
            justify-content: center;
            align-content: flex-start; /* BaÅŸlÄ±ÄŸÄ± ve iÃ§eriÄŸi Ã¼ste yaslar */
        }

        .category-drop-zone h3 {
            margin: 0 0 10px 0;
            font-size: 2.1rem; 
            color: var(--accent-color);
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
            width: 100%;
            text-align: center;
            flex-shrink: 0; /* BaÅŸlÄ±k kÃ¼Ã§Ã¼lmesin */
        }
        
        /* SaÄŸ taraf (Tek kutu) - 2 SÃ¼tuna ayarlandÄ± */
        .word-bank-container {
            flex-basis: 320px; /* 2 sÃ¼tuna sÄ±ÄŸacak geniÅŸlik */
            flex-shrink: 0; /* KÃ¼Ã§Ã¼lmesin */
            height: 100%; /* Tam yÃ¼kseklik */
            background: #fff;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 10px; 
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center; /* Dikey ortalama */
            gap: 6px; 
            overflow-y: auto; /* Kelimeler sÄ±ÄŸmazsa kaydÄ±r */
            box-sizing: border-box;
        }

        /* Elementler kÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
        .word-item {
            padding: 5px 8px; 
            color: white;
            font-size: 1.8rem; 
            font-weight: 700;
            border-radius: 6px; 
            cursor: grab;
            user-select: none;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            
            width: 120px;
            text-align: center;
            box-sizing: border-box; /* Padding geniÅŸliÄŸi etkilemesin */
        }
        
        .word-item:hover {
            filter: brightness(85%);
        }
        
        /* 1. Sadece fare sÃ¼rÃ¼klemesi iÃ§in (opaklÄ±k) */
        .word-item.mouse-dragging {
            opacity: 0.5;
        }
        
        /* 2. Sadece dokunmatik sÃ¼rÃ¼kleme iÃ§in (pozisyon) */
        .word-item.touch-dragging {
            opacity: 0.5;
            cursor: grabbing;
            position: fixed; 
            z-index: 1000;
            pointer-events: none;
        }
        
        .word-item.correct {
            cursor: default;
            background-color: var(--success-color) !important;
            filter: brightness(100%) !important;
        }


        /* --- Geri Bildirim EkranÄ± (âœ” / âŒ) --- */
        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 15rem;
            z-index: 200;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
            
            flex-direction: column; /* Simgeyi ve dÃ¼ÄŸmeyi alt alta diz */
        }
        .feedback-overlay.show {
            visibility: visible;
            opacity: 1;
        }
        .feedback-overlay .correct { color: var(--success-color); }
        .feedback-overlay .incorrect { color: var(--danger-color); }
        
        
        /* Yenileme DÃ¼ÄŸmesi Stili */
        #replay-button {
            display: none; /* VarsayÄ±lan olarak gizli */
            font-size: 4.5rem; 
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: transform 0.2s ease, background-color 0.2s ease;
            margin-top: 20px; /* Simge ile arasÄ±na boÅŸluk */
        }
        #replay-button:hover {
            transform: rotate(-90deg);
            background-color: #f0f0f0;
        }
        /* Sadece oyun bittiÄŸinde ve overlay gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde dÃ¼ÄŸmeyi gÃ¶ster */
        .feedback-overlay.show.game-finished #replay-button {
            display: block;
        }
        
        
        /* --- Mobil DÃ¼zen --- */
        @media (orientation: portrait) {
            .activity-container {
                width: 95vw;
                height: calc(95vw * 16 / 9); /* 9:16 */
                max-height: 95vh;
                max-width: calc(95vh * 9 / 16); /* 9:16 */
            }

            .header {
                grid-template-areas: "instruction back";
                grid-template-columns: 1fr auto; 
                gap: 10px;
                padding: 10px 15px;
            }

            #instruction-text {
                font-size: 1.4rem; 
            }
            
            /* Mobil: Sol-SaÄŸ dÃ¼zeni SÃ¼tun (Column) olsun */
            .categorize-container {
                flex-direction: column;
            }
            
            .word-bank-container {
                 flex-shrink: 0;
                 width: 100%; /* Tam geniÅŸlik */
                 height: auto;
                 flex-basis: auto; 
                 max-height: 200px; /* Ã‡ok taÅŸmasÄ±n */
                 align-content: center; 
            }
            
            .drop-zones-container {
                width: 100%;
                flex-grow: 1;
            }
            
            .category-drop-zone h3 {
                font-size: 1.5rem;
            }
            /* Mobilde kelimeler daha da kÃ¼Ã§Ã¼k */
            .word-item {
                font-size: 1.4rem; 
                padding: 4px 6px;
                width: 110px; 
            }
        }
        
        /* --- Tam Ekran DÃ¼ÄŸmesi --- */
        #fullscreen-btn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px; /* Geri tuÅŸundan ayÄ±r (saÄŸ) */
            margin-left: 10px; /* Kenardan ayÄ±r (sol) */
            flex-shrink: 0; /* KÃ¼Ã§Ã¼lmesini engelle */
        }
        #fullscreen-btn:hover {
            background: #e0e0e0;
        }
        #fullscreen-btn svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }
        /* SVG Simgelerini gizle/gÃ¶ster */
        #fullscreen-btn .icon-open { display: block; }
        #fullscreen-btn .icon-close { display: none; }
        body.fullscreen #fullscreen-btn .icon-open { display: none; }
        body.fullscreen #fullscreen-btn .icon-close { display: block; }

        /* --- Ana KonteynÄ±rÄ±n Tam Ekran DavranÄ±ÅŸÄ± --- */
        body.fullscreen .activity-container {
            width: 100vw;
            height: calc(100vw * 9 / 16);  
            max-height: 100vh;
            max-width: calc(100vh * 16 / 9);
            border-radius: 0;
            box-shadow: none;
        }

        /* --- Mobil (Dikey) Ekran DavranÄ±ÅŸÄ± --- */
        @media (orientation: portrait) {
            body.fullscreen .activity-container {
                width: 100vw;
                height: calc(100vw * 16 / 9);
                max-height: 100vh;
                max-width: calc(100vh * 9 / 16);
            }
        }


    </style>
</head>
<body>

    <div class="activity-container">
        
        <div class="header">
            <div id="instruction-text">...</div>
            <div class="back-button-container">
                <button id="fullscreen-btn">
                    <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 10h2V7h3V5H5v5zM14 5v2h3v3h2V5h-5zM5 19v-5h2v3h3v2H5zM14 19v-2h3v-3h2v5h-5z"/>
                    </svg>
                    <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>
                </button>
                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="activity-area" id="activity-area">
            </div>

        <div class="feedback-overlay" id="feedback-overlay">
            <span id="feedback-icon"></span>
            <button id="replay-button" onclick="restartGame()">ğŸ”„</button>
        </div>

    </div>

<script>
        // --- 20 benzersiz renk ---
        const colorPalette = [
            '#007bff', '#dc3545', '#28a745', '#ffc107', '#17a2b8', '#6f42c1', '#fd7e14',
            '#20c997', '#6610f2', '#e83e8c', '#d63384', '#198754', '#0d6efd', '#adb5bd',
            '#ff6b6b', '#fca311', '#90be6d', '#43aa8b', '#577590', '#f94144'
        ];

        // --- YENÄ°: ETKÄ°NLÄ°K VERÄ° BANKASI (Birden fazla seviye) ---
        const activityDataBank = [
            // --- Seviye 1: Ù‚ÙÙŠÙÙ…ÙŠ (DeÄŸerler) ---
            {
                title: "Ù‚ÙÙŠÙÙ…ÙŠ | ØµÙÙ†Ù‘ÙÙ Ø§Ù„Ù’ÙƒÙÙ„ÙÙ…Ø§Øª",
                categories: ["Ø§Ù„Ù…ÙØ¹Ø§Ù…ÙÙ„Ø§Øª Ø§Ù„Ø­ÙØ³ÙÙ†ÙØ©", "Ø£ÙØ¹Ù’Ø¶Ø§Ø¡ Ø§Ù„Ø£ÙØ³Ù’Ø±ÙØ©", "Ø£ÙÙ…Ø§ÙƒÙÙ†", "Ù…ÙÙ‡ÙÙ†"],
                words: [
                    // Ä°yi DavranÄ±ÅŸlar
                    { w: "ØµÙØ¯Ù’Ù‚", cat: "Ø§Ù„Ù…ÙØ¹Ø§Ù…ÙÙ„Ø§Øª Ø§Ù„Ø­ÙØ³ÙÙ†ÙØ©" },
                    { w: "Ø£ÙÙ…Ø§Ù†ÙØ©", cat: "Ø§Ù„Ù…ÙØ¹Ø§Ù…ÙÙ„Ø§Øª Ø§Ù„Ø­ÙØ³ÙÙ†ÙØ©" },
                    { w: "ØªÙØ¹Ø§ÙˆÙÙ†", cat: "Ø§Ù„Ù…ÙØ¹Ø§Ù…ÙÙ„Ø§Øª Ø§Ù„Ø­ÙØ³ÙÙ†ÙØ©" },
                    { w: "Ø§ÙØ­Ù’ØªÙØ±Ø§Ù…", cat: "Ø§Ù„Ù…ÙØ¹Ø§Ù…ÙÙ„Ø§Øª Ø§Ù„Ø­ÙØ³ÙÙ†ÙØ©" },
                    // Aile Bireyleri
                    { w: "Ø£ÙØ¨", cat: "Ø£ÙØ¹Ù’Ø¶Ø§Ø¡ Ø§Ù„Ø£ÙØ³Ù’Ø±ÙØ©" },
                    { w: "Ø£ÙÙ…Ù‘", cat: "Ø£ÙØ¹Ù’Ø¶Ø§Ø¡ Ø§Ù„Ø£ÙØ³Ù’Ø±ÙØ©" },
                    { w: "Ø£ÙØ®", cat: "Ø£ÙØ¹Ù’Ø¶Ø§Ø¡ Ø§Ù„Ø£ÙØ³Ù’Ø±ÙØ©" },
                    { w: "Ø£ÙØ®Ù’Øª", cat: "Ø£ÙØ¹Ù’Ø¶Ø§Ø¡ Ø§Ù„Ø£ÙØ³Ù’Ø±ÙØ©" },
                    // Mekanlar
                    { w: "Ù…ÙØ³Ù’Ø¬ÙØ¯", cat: "Ø£ÙÙ…Ø§ÙƒÙÙ†" },
                    { w: "Ù…ÙØ³Ù’ØªÙØ´Ù’ÙÙ‰", cat: "Ø£ÙÙ…Ø§ÙƒÙÙ†" },
                    { w: "Ù…ÙØµÙ’Ù†ÙØ¹", cat: "Ø£ÙÙ…Ø§ÙƒÙÙ†" },
                    { w: "Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©", cat: "Ø£ÙÙ…Ø§ÙƒÙÙ†" },
                    // Meslekler
                    { w: "Ø·ÙØ¨ÙŠØ¨", cat: "Ù…ÙÙ‡ÙÙ†" },
                    { w: "Ù…ÙÙ‡ÙÙ†Ù’Ø¯ÙØ³", cat: "Ù…ÙÙ‡ÙÙ†" },
                    { w: "Ø³Ø§Ø¦ÙÙ‚", cat: "Ù…ÙÙ‡ÙÙ†" },
                    { w: "Ù…ÙØ¹ÙÙ„Ù‘ÙÙ…", cat: "Ù…ÙÙ‡ÙÙ†" }
                ]
            },
            
           
        ];


        // --- Gerekli Elementler ---
        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        
        // --- Ses DeÄŸiÅŸkenleri ---
        let audioCtx = null;

        // --- Durum DeÄŸiÅŸkenleri ---
        let currentActivityIndex = 0; // YENÄ°: Mevcut seviyeyi takip eder
        let totalWordsRemaining = 0;
        let currentTouchEventItem = null;
        let touchOffsetX = 0;
        let touchOffsetY = 0;

        // --- SES FONKSÄ°YONLARI ---
        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(type) {
            if (!audioCtx) return; 
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            const now = audioCtx.currentTime;

            if (type === 'touch') {
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, now);
                oscillator.frequency.linearRampToValueAtTime(150, now + 0.3);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        }
        
        document.body.addEventListener('click', initAudioContext, { once: true });


        // --- Fisher-Yates KarÄ±ÅŸtÄ±rma Fonksiyonu ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- ETKÄ°NLÄ°K YÃœKLEYÄ°CÄ° (GÃœNCELLENDÄ°) ---
        function loadActivity() {
            activityArea.innerHTML = '';
            
            // Mevcut indekse gÃ¶re veriyi al
            const data = activityDataBank[currentActivityIndex];
            
            instructionText.textContent = data.title; // BaÅŸlÄ±ÄŸÄ± veriden al
            
            feedbackOverlay.classList.remove('show', 'game-finished');
            
            buildCategorize(data); // SeÃ§ilen veriyi yÃ¼kle
        }
        
        // --- SÄ±nÄ±flandÄ±rma ArayÃ¼zÃ¼nÃ¼ OluÅŸtur ---
        function buildCategorize(data) {
            const container = document.createElement('div');
            container.className = 'categorize-container';

            // 1. BÄ±rakma AlanlarÄ± (Kategoriler)
            const dropZonesContainer = document.createElement('div');
            dropZonesContainer.className = 'drop-zones-container';
            
            data.categories.forEach((categoryName, index) => {
                const dropZone = document.createElement('div');
                dropZone.className = 'category-drop-zone';
                dropZone.dataset.category = categoryName; 
                
                const title = document.createElement('h3');
                title.textContent = categoryName;
                
                dropZone.appendChild(title);
                dropZonesContainer.appendChild(dropZone);
            });
            
            // 2. Kelime BankasÄ±
            const wordBank = document.createElement('div');
            wordBank.className = 'word-bank-container';
            wordBank.id = 'word-bank-container'; 
            
            const shuffledWords = shuffle([...data.words]);
            totalWordsRemaining = shuffledWords.length; 
            
            shuffledWords.forEach((wordData, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.id = `word-${index}`;
                wordItem.textContent = wordData.w;
                wordItem.dataset.wordCat = wordData.cat; 
                wordItem.draggable = true;
                wordItem.style.backgroundColor = colorPalette[index % colorPalette.length];
                
                wordBank.appendChild(wordItem);
            });
            
            container.appendChild(dropZonesContainer);
            container.appendChild(wordBank);
            activityArea.appendChild(container);
            
            // 3. Olay dinleyicilerini ekle
            addDragDropListeners();
        }

        // --- SÃ¼rÃ¼kle-BÄ±rak ve Dokunmatik Dinleyicileri ---
        function addDragDropListeners() {
            const draggables = document.querySelectorAll('.word-item');
            const containers = document.querySelectorAll('.category-drop-zone, .word-bank-container');

            // 1. Fare (Mouse) OlaylarÄ±
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    draggable.classList.add('mouse-dragging'); 
                    e.dataTransfer.setData('text/plain', draggable.id);
                    playSound('touch');
                });
                draggable.addEventListener('dragend', (e) => {
                    e.target.classList.remove('mouse-dragging');
                });
            });

            containers.forEach(container => {
                container.addEventListener('dragover', e => e.preventDefault());
                
                container.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const id = e.dataTransfer.getData('text/plain');
                    const wordElement = document.getElementById(id);
                    const dropZone = e.target.closest('.category-drop-zone');
                    
                    if (wordElement && dropZone) {
                        checkCategoryDrop(wordElement, dropZone);
                    } else if (wordElement && e.target.closest('.word-bank-container')) {
                        e.target.closest('.word-bank-container').appendChild(wordElement);
                    }
                });
            });

            // 2. Dokunmatik (Touch) BaÅŸlangÄ±Ã§ OlaylarÄ±
            draggables.forEach(draggable => {
                draggable.addEventListener('touchstart', (e) => {
                    if (currentTouchEventItem || e.target.classList.contains('correct')) return;
                    e.preventDefault(); // KaydÄ±rmayÄ± engelle

                    currentTouchEventItem = e.target;
                    playSound('touch');
                    
                    const touch = e.touches[0];
                    const rect = currentTouchEventItem.getBoundingClientRect();
                    touchOffsetX = touch.clientX - rect.left;
                    touchOffsetY = touch.clientY - rect.top;

                    currentTouchEventItem.classList.add('touch-dragging'); 
                    currentTouchEventItem.style.left = `${touch.clientX - touchOffsetX}px`;
                    currentTouchEventItem.style.top = `${touch.clientY - touchOffsetY}px`;

                }, { passive: false }); // passive: false GEREKLÄ°
            });
        }
        
        // --- Global Dokunmatik Dinleyiciler ---
        function setupGlobalTouchListeners() {
            document.addEventListener('touchmove', (e) => {
                if (!currentTouchEventItem) return;
                e.preventDefault(); 
                
                const touch = e.touches[0];
                currentTouchEventItem.style.left = `${touch.clientX - touchOffsetX}px`;
                currentTouchEventItem.style.top = `${touch.clientY - touchOffsetY}px`;

            }, { passive: false }); // passive: false GEREKLÄ°

            document.addEventListener('touchend', (e) => {
                if (!currentTouchEventItem) return;

                const touch = e.changedTouches[0];
                
                currentTouchEventItem.style.visibility = 'hidden';
                const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
                currentTouchEventItem.style.visibility = 'visible';
                
                currentTouchEventItem.classList.remove('touch-dragging');
                currentTouchEventItem.style.position = ''; 
                currentTouchEventItem.style.left = 'auto';
                currentTouchEventItem.style.top = 'auto';

                const dropZone = dropTarget ? dropTarget.closest('.category-drop-zone') : null;
                const wordBank = dropTarget ? dropTarget.closest('.word-bank-container') : null;

                if (dropZone) {
                    checkCategoryDrop(currentTouchEventItem, dropZone);
                } else if (wordBank) {
                    wordBank.appendChild(currentTouchEventItem);
                } else {
                    document.getElementById('word-bank-container').appendChild(currentTouchEventItem);
                }
                
                currentTouchEventItem = null; // SÃ¼rÃ¼klemeyi bitir
            });
        }
        
        // --- Kategori Kontrol Fonksiyonu (GÃœNCELLENDÄ°) ---
        function checkCategoryDrop(wordElement, dropZone) {
            const zoneCategory = dropZone.dataset.category;
            const wordCategory = wordElement.dataset.wordCat;

            if (zoneCategory === wordCategory) {
                playSound('correct');
                dropZone.appendChild(wordElement); 
                wordElement.draggable = false;
                wordElement.classList.add('correct'); 
                wordElement.classList.remove('mouse-dragging', 'touch-dragging');
                
                totalWordsRemaining--; 
                
                if (totalWordsRemaining === 0) {
                    instructionText.textContent = "Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª! Ù„ÙÙ‚ÙØ¯ Ø£ÙÙƒÙ’Ù…ÙÙ„Ù’ØªÙ";
                    feedbackOverlay.classList.add('game-finished');
                    
                    // --- YENÄ°: Bir sonraki seviyeye geÃ§ ---
                    currentActivityIndex++;
                    // EÄŸer son seviyeyi bitirdiyse baÅŸa dÃ¶n
                    if (currentActivityIndex >= activityDataBank.length) {
                        currentActivityIndex = 0; 
                    }
                    
                    showFeedback(true); 
                }
            } else {
                playSound('incorrect');
                wordElement.classList.remove('mouse-dragging', 'touch-dragging');
                document.getElementById('word-bank-container').appendChild(wordElement);
            }
        }


        // --- Geri Bildirim (âœ” / âŒ) ---
        function showFeedback(isCorrect) {
            if (isCorrect) {
                feedbackIcon.textContent = 'âœ”';
                feedbackIcon.className = 'correct';
                playSound('correct');
                feedbackOverlay.classList.add('show');
            }
        }
        
        // --- Oyunu Yeniden BaÅŸlat Fonksiyonu (GÃœNCELLENDÄ°) ---
        function restartGame() {
            playSound('touch');
            
            // Overlay'i gizle
            feedbackOverlay.classList.remove('show', 'game-finished'); 
            
            // Bir sonraki (veya gÃ¼ncel) aktiviteyi yÃ¼kle
            loadActivity(); 
        }
        
        
        // --- Tam Ekran FonksiyonlarÄ± ---
        function setupFullscreen() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const body = document.body;

            if (!fullscreenBtn) return; 

            const docEl = document.documentElement;
            const requestFs = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullscreen || docEl.msRequestFullscreen;
            const exitFs = document.exitFullscreen || document.mozCancelFullScreen || document.webkitExitFullscreen || document.msExitFullscreen;

            function getFullscreenElement() {
                return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
            }

            function toggleFullScreen() {
                if (!getFullscreenElement()) {
                    if(requestFs) {
                        requestFs.call(docEl).catch(err => {
                            console.error(`Tam ekrana geÃ§ilemedi: ${err.message} (${err.name})`);
                        });
                    }
                } else {
                    if(exitFs) {
                        exitFs.call(document).catch(err => {
                            console.error(`Tam ekrandan Ã§Ä±kÄ±lamadÄ±: ${err.message} (${err.name})`);
                        });
                    }
                }
            }

            function syncFullscreenState() {
                if (getFullscreenElement()) {
                    body.classList.add('fullscreen');
                } else {
                    body.classList.remove('fullscreen');
                }
            }

            fullscreenBtn.addEventListener('click', toggleFullScreen);
            
            document.addEventListener('fullscreenchange', syncFullscreenState);
            document.addEventListener('mozfullscreenchange', syncFullscreenState);
            document.addEventListener('webkitfullscreenchange', syncFullscreenState);
            document.addEventListener('msfullscreenchange', syncFullscreenState);
        }

        
        // --- BaÅŸlangÄ±Ã§ ---
        document.addEventListener('DOMContentLoaded', () => {
            loadActivity(); // Ä°lk aktiviteyi (indeks 0) yÃ¼kle
            setupGlobalTouchListeners();
            setupFullscreen(); 
        });

    </script>   
</body>
</html>